import{r as e,o as t,a,c as o,b as s,d as n,e as r,w as l,f as i,g as d,n as c,u,t as p,h as m,i as g,j as f,k as v,l as y,F as h,m as x,p as b,q as k,s as w,v as D,x as M,y as N,z as P,A as C,B as S,C as _}from"./vue-CRqQotYD.js";import{r as $,g as j}from"./leaflet-DtqLV9Sc.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O=e(!1);function A(){O.value=window.innerWidth<768}const L={__name:"App",setup:e=>(t(()=>{A(),window.addEventListener("resize",A)}),a(()=>{window.removeEventListener("resize",A)}),(e,t)=>{const a=s("router-view");return n(),o(a)})},B={};let E;const T="click_outbound_link";let R=!1;async function V(){try{const e="phc_w0axXDyN3zCal0qUUsV83NnyCoKsI9AKHXR59aat3tP";if(R)return;const t=await function(e,t){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=(null==o?void 0:o.nonce)||(null==o?void 0:o.getAttribute("nonce"));a=e(t.map(e=>{if((e=function(e){return"/nyc-water-app/"+e}(e))in B)return;B[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,s&&o.setAttribute("nonce",s),document.head.appendChild(o),t?new Promise((t,a)=>{o.addEventListener("load",t),o.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})}(()=>import("./analytics-BlUJbZ5Q.js"),[]);E=t.default||t;const a="https://app.posthog.com";E.init(e,{api_host:a,autocapture:!0,debug:!1}),R=!0}catch(e){}}function q(e,t={}){try{if(!R||!E)return;E.capture(e,t)}catch(a){}}const I="/nyc-water-app",z="2025-10-02";const F=e(!0);"undefined"!=typeof document&&(document.documentElement.classList.toggle("dark",F.value),document.body.classList.toggle("dark",F.value)),l(F,e=>{"undefined"!=typeof document&&(document.documentElement.classList.toggle("dark",e),document.body.classList.toggle("dark",e))});const W=()=>{F.value=!F.value},U=i({__name:"ThemeToggleButton",props:{isDarkMode:{type:Boolean,default:!1},sticky:{type:Boolean,default:!0}},setup:e=>(e,t)=>(n(),d("button",{onClick:t[0]||(t[0]=(...e)=>u(W)&&u(W)(...e)),class:c(["w-10 h-10 rounded-full shadow-md flex items-center justify-center transition-colors duration-300",[e.sticky?"fixed top-4 right-4 z-50":"",e.isDarkMode?"bg-gray-800 text-white":"bg-white text-gray-800"]])},p(e.isDarkMode?"☀️":"🌙"),3))}),H={class:"flex-1 flex flex-col"},Q={class:"px-6 py-8 relative"},Y={class:"absolute top-4 right-4"},G={class:"flex-1 flex flex-col items-center justify-center px-6 py-12"},K={class:"max-w-4xl mx-auto text-center space-y-12"},J={class:"space-y-6"},Z={key:0,class:"animate-pulse"},X={key:1,class:"text-red-500"},ee={class:"text-xl"},te={key:2,class:"space-y-8"},ae={class:"text-5xl md:text-7xl lg:text-8xl font-bold leading-tight tracking-tight"},oe={class:"block text-blue-600 dark:text-blue-400"},se={class:"text-3xl md:text-4xl lg:text-5xl font-semibold text-red-600 dark:text-red-400"},ne={class:"max-w-2xl mx-auto space-y-6"},re={class:"px-6 py-8 text-center"},le={class:"flex flex-col items-center space-y-4"},ie=(e,t)=>{const a=e.__vccOpts||e;for(const[o,s]of t)a[o]=s;return a},de=ie(i({__name:"welcome",setup(a){const o=m(),{stats:s,loadYearlyStats:l}=function(){const t=e(!0),a=e(null),o=e([]);return{stats:r(()=>0===o.value.length?{totalSamples:0,unsafeSamples:0,safeSamples:0,loading:t.value,error:a.value}:{totalSamples:o.value.reduce((e,t)=>e+t.totalSites,0),unsafeSamples:o.value.reduce((e,t)=>e+t.cautionSites+t.poorSites,0),safeSamples:o.value.reduce((e,t)=>e+t.goodSites,0),loading:t.value,error:a.value}),loadYearlyStats:async()=>{try{t.value=!0,a.value=null;const e=await fetch("/nyc-water-app/data/dates.json");if(!e.ok)throw new Error("Failed to load dates");const s=(await e.json()).map(async e=>{try{const t=`staticData-${e}`,a="undefined"!=typeof sessionStorage&&sessionStorage.getItem(t);let o,s=0;if(a)o=JSON.parse(a).geojson;else{const t=await fetch(`/nyc-water-app/data/${e}/enriched.geojson`);if(!t.ok)return null;o=await t.json()}let n=0,r=0,l=0;return o.features.forEach(e=>{const t=e.properties.mpn;null!=t&&(s++,t<=35?n++:t<=104?r++:l++)}),{date:e,totalSites:s,goodSites:n,cautionSites:r,poorSites:l,lastUpdated:e}}catch(t){return null}}),n=await Promise.all(s);o.value=n.filter(e=>null!==e)}catch(e){a.value=e instanceof Error?e.message:"Failed to load yearly stats"}finally{t.value=!1}}}}();t(()=>{l()});const i=()=>{o.push(`/${z}`)};return(e,t)=>(n(),d("div",{class:c(["min-h-screen flex flex-col",u(F)?"bg-gray-900 text-white":"bg-white text-gray-900"])},[g("div",H,[g("header",Q,[g("div",Y,[f(U,{isDarkMode:u(F),sticky:!1},null,8,["isDarkMode"])]),t[0]||(t[0]=g("h1",{class:"text-2xl md:text-2xl font-bold mb-4 tracking-tight text-left"}," NYC Water Quality ",-1))]),g("main",G,[g("div",K,[g("div",J,[u(s).loading?(n(),d("div",Z,t[1]||(t[1]=[g("div",{class:"h-16 md:h-24 bg-gray-300 dark:bg-gray-700 rounded mb-4"},null,-1),g("div",{class:"h-16 md:h-24 bg-gray-300 dark:bg-gray-700 rounded"},null,-1)]))):u(s).error?(n(),d("div",X,[g("p",ee,"Failed to load data: "+p(u(s).error),1)])):(n(),d("div",te,[g("h2",ae,[t[2]||(t[2]=g("span",{class:"block"},"WE'VE COLLECTED",-1)),g("span",oe,p(u(s).totalSamples.toLocaleString()),1),t[3]||(t[3]=g("span",{class:"block"},"SAMPLES",-1)),t[4]||(t[4]=g("span",{class:"block"},"THIS YEAR",-1))]),g("p",se,p(u(s).unsafeSamples.toLocaleString())+" have tested unsafe for human contact ",1)]))]),g("div",ne,[g("p",{class:c(["text-lg md:text-xl leading-relaxed",u(F)?"text-gray-300":"text-gray-700"])}," This app visualizes water quality data from New York City's waterways, showing bacterial contamination levels at sampling sites across the five boroughs. The data helps residents understand which areas may be unsafe for activities like swimming, kayaking, or fishing. ",2),g("p",{class:c(["text-base md:text-lg leading-relaxed",u(F)?"text-gray-400":"text-gray-600"])}," Samples are categorized as safe (green), caution (yellow), or unsafe (red) based on bacterial levels. Higher bacterial counts typically occur after rainfall when stormwater runoff carries pollutants into waterways. ",2)])])]),g("footer",re,[g("div",le,[g("button",{onClick:i,class:c(["inline-flex items-center px-8 py-4 text-xl font-semibold rounded-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500/50 shadow-lg hover:shadow-xl",(u(F),"bg-blue-600 hover:bg-blue-700 text-white")])},t[5]||(t[5]=[g("svg",{class:"w-6 h-6 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"})],-1),v(" View Latest Map Data ")]),2),g("p",{class:c(["text-sm",u(F)?"text-gray-400":"text-gray-600"])}," Last update: "+p((new Date).toLocaleDateString()),3)])])])],2))}}),[["__scopeId","data-v-60f89490"]]);const ce=j($()),ue=e(!1),pe=35,me=104,ge=24196,fe="#22c55e",ve="#facc15",ye="#ef4444";function he(e){const t=function(e){if(null===e)return ve;const t=Number(e);return Number.isNaN(t)?ve:t<pe?fe:t<=me?ve:ye}(e);return ce.divIcon({html:`\n      <div style="width: 16px; height: 32px; color: ${t}">\n        <svg viewBox="0 0 32 64" xmlns="http://www.w3.org/2000/svg" width="16" height="32">\n          <rect x="8" y="2" width="16" height="6" rx="2" fill="#ccc" stroke="black" stroke-width="0.5"/>\n          <rect x="10" y="8" width="12" height="4" rx="2" fill="#eee" stroke="black" stroke-width="0.5"/>\n          <rect x="6" y="12" width="20" height="44" rx="6" fill="currentColor" stroke="white" stroke-width="1"/>\n          <ellipse cx="16" cy="58" rx="8" ry="2" fill="white" opacity="0.2"/>\n        </svg>\n      </div>\n    `,className:"water-bottle-icon",iconSize:[16,32],iconAnchor:[8,32],popupAnchor:[0,-34]})}function xe(e,t){const a=["F","S","S","M","T","W","Th"],o=(e||[]).filter(e=>"number"==typeof e&&!Number.isNaN(e)),s=o.length?Math.max(...o):0;return`\n    <div class="flex items-end justify-between h-16 mb-1">\n      ${e.map((e,o)=>{const n=0===s||null===e?0:e/s*100,r=e&&e>0?Number(e).toFixed(1):"";return`\n            <div class="flex flex-col items-center group h-full justify-end">\n              <div class="text-xs opacity-70 mb-1 font-medium" style="${r?"":"visibility:hidden"}">${r}</div>\n              <div class="w-4 rounded-t transition-all duration-300 shadow-md border border-black/10 min-h-[1px] ${l=e,null==l?t?"bg-gray-500":"bg-gray-300":l<.5?t?"bg-green-600":"bg-green-500":l<3?t?"bg-yellow-500":"bg-yellow-400":t?"bg-red-600":"bg-red-500"}" style="height:${n}%"></div>\n              <span class="text-xs mt-1 font-medium">${a[o%7]}</span>\n            </div>`;var l}).join("")}\n    </div>`}function be(e){const t=new Date(e),a=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`Sampled on ${t.getMonth()+1}/${t.getDate()} at ${a}`}const ke=i({__name:"MapViewer",props:{selectedDate:{},isDarkMode:{type:Boolean,default:!1},geojson:{default:null}},setup(o){const s=o,r=e(null),i=e(null),u=e([]),p=e(null),m=e(!1),f=()=>function({map:e,tileLayer:t,markers:a,isDarkMode:o}){if(!e.value)return;t.value&&e.value.removeLayer(t.value);const s=o?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png";t.value=ce.tileLayer(s,{attribution:"",maxZoom:19,subdomains:"abcd"}).addTo(e.value),function({map:e,markers:t,isDarkMode:a}){e.value&&t.value.forEach(e=>{const t=e.getPopup();if(t){const o=t.getContent();e.closePopup().unbindPopup(),e.bindPopup(o||"",{className:a?"dark-mode-popup":""})}})}({map:e,markers:a,isDarkMode:o})}({map:i,tileLayer:p,markers:u,isDarkMode:s.isDarkMode}),v=e=>function({map:e,markers:t,hasAutoFitted:a,isDarkMode:o,data:s}){if(!e.value)return;const n=e.value.getCenter(),r=e.value.getZoom();for(const i of t.value)i.remove();if(t.value=[],s.features&&0!==s.features.length){for(const a of s.features)try{if(!a.geometry||!a.geometry.coordinates||a.geometry.coordinates.length<2)continue;if(!a.properties)continue;const s=a.properties.siteName||"",n=a.properties.mpn,r=a.properties.timestamp||"";if(void 0===n)continue;const[l,i]=a.geometry.coordinates;if(isNaN(i)||isNaN(l))continue;const d=he(n);let c,u;d.options.popupAnchor=[0,-40];const p=Number(n);p<35?(c="text-green-500",u="Acceptable for swimming"):p<=104?(c="text-yellow-400",u="Unacceptable if levels persist"):(c="text-red-500",u="Unacceptable for swimming");const m=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),g=m(s),f=m(null===n?"N/A":n.toString()),v=Number(n)===ge;let y=`\n        <div class="site-popup">\n          <div class="font-semibold text-lg site-name">${g}</div>\n          <div class="mt-2 ${c} font-medium text-base">\n            ${f}${v?"*":""} MPN/100mL\n          </div>\n          <div class="mt-1 text-sm opacity-75">\n            ${u}\n          </div>\n      `;if(v&&(y+='<div class="text-xs opacity-75 mt-1">*Sample reached the instrument detection limit.</div>'),r&&(y+=`<div class="text-xs opacity-75 mt-1">${m(be(r))}</div>`),(a.properties.tide||void 0!==a.properties.rainfall_mm_7day)&&(y+='<div class="text-xs font-medium mt-3 pt-2 border-t border-gray-200">Environmental Conditions:</div>'),a.properties.tide&&(y+=`<div class="text-xs opacity-75 mt-1"><span title="Tidal data is taken from nearest NOAA station and is only approximate">${m(a.properties.tide)}</span></div>`),void 0!==a.properties.rainfall_mm_7day&&null!==a.properties.rainfall_mm_7day){const e=a.properties.rainfall_mm_7day||0,t=m(Number((.0393701*e).toFixed(2)).toFixed(2));if(O.value){const e=a.properties.rainByDay||[];y+=`<div class="text-xs opacity-75 mt-1">Total rainfall (7-day): ${t} in</div>`,y+='<button class="rain-toggle text-xs underline mt-1">Rain details</button>',y+=`<div class="rain-details hidden mt-1">${xe(e,o)}</div>`}else y+=`<div class="text-xs opacity-75 mt-1"><span title="Rainfall data for the 7 days prior to sample date">Rainfall: ${t} in (7-day)</span></div>`}if(void 0!==a.properties.goodCount&&void 0!==a.properties.cautionCount&&void 0!==a.properties.poorCount){const e=m(a.properties.goodCount),t=m(a.properties.cautionCount),o=m(a.properties.poorCount);y+='<div class="text-xs font-medium mt-3 pt-2 border-t border-gray-200">This season:</div>',y+=`<div class="text-xs opacity-75 mt-1">${e} good, ${t} caution, ${o} poor</div>`}y+="</div>";const h=ce.marker([i,l],{icon:d}).bindPopup(y,{className:o?"dark-mode-popup":""}).addTo(e.value);h.on("click",()=>{q("click_site_marker",{site_name:s})}),h.on("popupopen",e=>{ue.value=!0;const t=e.popup.getElement(),a=null==t?void 0:t.querySelector(".rain-toggle");a&&a.addEventListener("click",()=>{const e=null==t?void 0:t.querySelector(".rain-details");e&&e.classList.toggle("hidden")})}),h.on("popupclose",()=>{ue.value=!1}),t.value.push(h)}catch(l){}if(t.value.length>0)if(a.value)e.value.setView(n,r);else{const o=ce.featureGroup(t.value);e.value.fitBounds(o.getBounds(),{padding:[30,30]}),a.value=!0}}}({map:i,markers:u,hasAutoFitted:m,isDarkMode:s.isDarkMode,data:e});return l(()=>s.isDarkMode,()=>{i.value&&r.value&&f()}),l(()=>s.geojson,e=>{e&&i.value&&v(e)},{immediate:!0}),t(()=>{r.value&&(i.value=ce.map(r.value).setView([40.7128,-74.006],12),f(),i.value.removeControl(i.value.zoomControl),s.geojson&&v(s.geojson))}),a(()=>{i.value&&i.value.remove()}),(e,t)=>(n(),d("div",{class:c(["w-full h-full",e.isDarkMode?"bg-gray-800":"bg-white"])},[g("div",{ref_key:"mapContainer",ref:r,class:"absolute inset-0 z-0"},null,512)],2))}}),we=["F","S","S","M","T","W","Th"],De={name:"RainDropLegend",props:{selectedDate:{type:String,required:!0},isDarkMode:{type:Boolean,default:!1},rainfallData:{type:Array,default:()=>[]}},setup(e){const t=r(()=>e.rainfallData&&e.rainfallData.length>0?e.rainfallData:[]),a=r(()=>t.value.reduce((e,t)=>e+(t||0),0)),o=r(()=>a.value.toFixed(2)),s=r(()=>t.value.length>0&&t.value.some(e=>null!=e&&e>=0));return{activeRainData:t,totalRainfall:a,totalRainfallValue:o,hasValidRainfallData:s,getBarColorClass:t=>null==t?e.isDarkMode?"bg-gray-500":"bg-gray-300":t<.5?e.isDarkMode?"bg-green-600":"bg-green-500":t<3?e.isDarkMode?"bg-yellow-500":"bg-yellow-400":e.isDarkMode?"bg-red-600":"bg-red-500",getDayLabel:e=>we[e%7],getBarHeight:e=>{const a=t.value.filter(e=>"number"==typeof e&&!Number.isNaN(e)),o=a.length?Math.max(...a):0;return 0===o?10:0===e?5:Math.max(e/o*100,10)},isMobile:O,featurePopupOpen:ue}}},Me={class:"flex items-end justify-between h-16 mb-1"},Ne={key:0,class:"text-xs opacity-70 mb-1 font-medium"},Pe=["title"],Ce={class:"text-xs mt-1 font-medium"},Se={class:"font-bold"};const _e=ie(De,[["render",function(e,t,a,o,s,r){return o.isMobile&&o.featurePopupOpen||!o.hasValidRainfallData?y("",!0):(n(),d("div",{key:0,class:c(["rain-drop-legend p-3 rounded shadow-md",a.isDarkMode?"bg-gray-800 text-gray-200":"bg-white text-gray-800"])},[t[2]||(t[2]=g("h3",{class:"text-xs font-medium mb-2"},"7-Day Rainfall",-1)),g("div",Me,[(n(!0),d(h,null,x(o.activeRainData,(e,t)=>(n(),d("div",{key:t,class:"flex flex-col items-center group h-full justify-end"},[e>0?(n(),d("div",Ne,p(e.toFixed(1)),1)):y("",!0),g("div",{class:c(["w-4 md:w-5 rounded-t transition-all duration-300 shadow-md border border-black/10 min-h-[1px]",o.getBarColorClass(e)]),style:b({height:`${o.getBarHeight(e)}%`}),title:`${null!=e?Number(e).toFixed(2):"No data"} inches`},null,14,Pe),g("span",Ce,p(o.getDayLabel(t)),1)]))),128))]),g("div",{class:c(["text-xs text-center mt-2 pt-2 border-t",a.isDarkMode?"border-gray-700":"border-gray-200"])},[t[0]||(t[0]=g("span",{class:"font-semibold"},"Total rainfall:",-1)),g("span",Se,p(o.totalRainfallValue),1),t[1]||(t[1]=g("span",null,"in",-1))],2)],2))}],["__scopeId","data-v-71a941d4"]]),$e={name:"SampleBarLegend",props:{samples:{type:Array,required:!0},isDarkMode:{type:Boolean,default:!1}},setup(e){const t=r(()=>e.samples.filter(e=>Number(e.properties.mpn)<35).length),a=r(()=>e.samples.filter(e=>{const t=Number(e.properties.mpn);return t>=35&&t<=104}).length),o=r(()=>e.samples.filter(e=>Number(e.properties.mpn)>104).length),s=r(()=>e.samples.length),n=r(()=>s.value>0?t.value/s.value*100:0),l=r(()=>s.value>0?a.value/s.value*100:0),i=r(()=>s.value>0?o.value/s.value*100:0);return{greenCount:t,yellowCount:a,redCount:o,totalCount:s,greenPercentage:n,yellowPercentage:l,redPercentage:i,isMobile:O,featurePopupOpen:ue}}},je={class:"w-full h-4 rounded-full overflow-hidden flex"},Oe=["title"],Ae=["title"],Le=["title"],Be={class:"flex justify-between text-xs mt-1"},Ee={class:"flex items-center"},Te={class:"flex items-center"},Re={class:"flex items-center"},Ve={class:"font-bold"};const qe=ie($e,[["render",function(e,t,a,o,s,r){return o.isMobile&&o.featurePopupOpen?y("",!0):(n(),d("div",{key:0,class:c(["sample-bar-legend p-2 rounded shadow-md",a.isDarkMode?"bg-gray-800 text-gray-200":"bg-white text-gray-800"])},[t[4]||(t[4]=g("h3",{class:"text-xs font-medium mb-1"},"Sample Quality",-1)),g("div",je,[o.greenCount>0?(n(),d("div",{key:0,class:"h-full bg-green-500 transition-all duration-500 ease-out",style:b({width:`${o.greenPercentage}%`}),title:`${o.greenCount} Good samples`},null,12,Oe)):y("",!0),o.yellowCount>0?(n(),d("div",{key:1,class:"h-full bg-yellow-400 transition-all duration-500 ease-out",style:b({width:`${o.yellowPercentage}%`}),title:`${o.yellowCount} Moderate samples`},null,12,Ae)):y("",!0),o.redCount>0?(n(),d("div",{key:2,class:"h-full bg-red-500 transition-all duration-500 ease-out",style:b({width:`${o.redPercentage}%`}),title:`${o.redCount} Poor samples`},null,12,Le)):y("",!0)]),g("div",Be,[g("div",Ee,[t[0]||(t[0]=g("span",{class:"inline-block w-2 h-2 bg-green-500 rounded-full mr-1"},null,-1)),g("span",null,p(o.greenCount),1)]),g("div",Te,[t[1]||(t[1]=g("span",{class:"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-1"},null,-1)),g("span",null,p(o.yellowCount),1)]),g("div",Re,[t[2]||(t[2]=g("span",{class:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"},null,-1)),g("span",null,p(o.redCount),1)])]),g("div",{class:c(["text-xs text-center mt-2 pt-2 border-t",a.isDarkMode?"border-gray-700":"border-gray-200"])},[t[3]||(t[3]=g("span",{class:"font-semibold"},"Total sites:",-1)),g("span",Ve,p(o.totalCount),1)],2)],2))}],["__scopeId","data-v-b3390d92"]]),Ie={name:"DateScroller",props:{dates:{type:Array,required:!0},modelValue:{type:String,required:!0},isDarkMode:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=m(),o=r(()=>e.dates.indexOf(e.modelValue)),s=r(()=>o.value>0),n=r(()=>o.value<e.dates.length-1),l=r(()=>{if(!e.modelValue)return"";try{const[t,a,o]=e.modelValue.split("-").map(Number);return new Date(Date.UTC(t,a-1,o)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})}catch(t){return e.modelValue}});return{currentIndex:o,hasPrevious:s,hasNext:n,formattedModelValue:l,selectPrevious:()=>{if(s.value){const s=e.dates[o.value-1];t("update:modelValue",s),a.push({path:`/${s}`})}},selectNext:()=>{if(n.value){const s=e.dates[o.value+1];t("update:modelValue",s),a.push({path:`/${s}`})}}}}},ze={class:"fixed bottom-[calc(6rem+env(safe-area-inset-bottom,0px))] left-1/2 transform -translate-x-1/2 z-[320]"},Fe={class:"px-2 text-center whitespace-nowrap"};const We=ie(Ie,[["render",function(e,t,a,o,s,r){return n(),d("div",ze,[g("div",{class:c(["inline-flex items-center rounded-full px-6 py-3 shadow-md transition-colors duration-300",a.isDarkMode?"bg-gray-800 bg-opacity-90":"bg-white bg-opacity-90"])},[g("button",{class:c(["w-10 h-10 flex items-center justify-center mr-3 focus:outline-none transition-colors duration-300 text-xl",a.isDarkMode?"text-gray-300 hover:text-white":"text-gray-700 hover:text-black",{"opacity-0 pointer-events-none":!o.hasPrevious}]),"aria-label":"Previous date",onClick:t[0]||(t[0]=e=>o.hasPrevious&&o.selectPrevious())}," ← ",2),g("div",Fe,[g("span",{class:c(["font-semibold transition-colors duration-300 text-sm sm:text-lg",a.isDarkMode?"text-gray-200":"text-gray-800"])},p(o.formattedModelValue),3)]),g("button",{class:c(["w-10 h-10 flex items-center justify-center ml-3 focus:outline-none transition-colors duration-300 text-xl",a.isDarkMode?"text-gray-300 hover:text-white":"text-gray-700 hover:text-black",{"opacity-0 pointer-events-none":!o.hasNext}]),"aria-label":"Next date",onClick:t[1]||(t[1]=e=>o.hasNext&&o.selectNext())}," → ",2)],2)])}]]),Ue=e(null),He=r(()=>null!==Ue.value);function Qe(e,t,a){const{isOpen:o,togglePopup:s,closePopup:n}=function(e){const t=r({get:()=>Ue.value===e,set:t=>{t?Ue.value=e:Ue.value===e&&(Ue.value=null)}});return{isOpen:t,togglePopup:()=>{t.value=!t.value},closePopup:()=>{Ue.value===e&&(Ue.value=null)}}}(e);return{isOpen:o,togglePopup:(e=!0)=>{try{const n=!o.value;s(),n&&e&&(q("open_popup",{component:t}),a&&q(a))}catch(n){s()}},closePopup:n}}const Ye={class:"flex justify-between items-center mb-2"},Ge={class:"font-bold"},Ke={__name:"PopupContainer",props:{isOpen:{type:Boolean,required:!0},isDarkMode:{type:Boolean,required:!0},title:{type:String,required:!0}},emits:["close"],setup(t,{emit:o}){const s=t,r=o,i=e(null),u=e=>{i.value&&!i.value.contains(e.target)&&r("close")};return l(()=>s.isOpen,e=>{e?document.addEventListener("click",u):document.removeEventListener("click",u)}),a(()=>{document.removeEventListener("click",u)}),(e,a)=>t.isOpen?(n(),d("div",{key:0,ref_key:"popupRef",ref:i,onClick:a[1]||(a[1]=w(()=>{},["stop"])),class:c(["fixed z-[400] bottom-[calc(4rem+env(safe-area-inset-bottom,0px))] left-1/2 transform -translate-x-1/2","p-4 sm:p-6 rounded-lg shadow-lg","max-h-[calc(100vh-6rem)] overflow-y-auto scrollbar-stable","w-full sm:w-[455px] max-w-[95vw]","transition-colors duration-300",t.isDarkMode?"bg-gray-800 text-white":"bg-white text-black"])},[g("div",Ye,[g("h3",Ge,p(t.title),1),g("button",{class:c(t.isDarkMode?"text-gray-400 hover:text-white":"text-gray-500 hover:text-gray-700"),onClick:a[0]||(a[0]=t=>e.$emit("close"))}," × ",2)]),g("div",{class:c(["prose text-sm",t.isDarkMode?"text-gray-300":"text-gray-700"])},[k(e.$slots,"default")],2)],2)):y("",!0)}},Je=["title"],Ze={class:"font-semibold text-lg pointer-events-none"},Xe={__name:"PopupButton",props:{isDarkMode:{type:Boolean,required:!0},icon:{type:String,required:!0},title:{type:String,required:!0},variant:{type:String,default:"default",validator:e=>["default","notification"].includes(e)},showNotification:{type:Boolean,default:!1}},emits:["click"],setup:e=>(t,a)=>(n(),d("button",{class:c(["rounded-full w-10 h-10 flex items-center justify-center shadow-lg transition-colors duration-300 pointer-events-auto touch-action-manipulation","notification"===e.variant&&e.showNotification?"bg-orange-700 text-white hover:bg-orange-800":e.isDarkMode?"bg-gray-800 text-gray-200 hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-100"]),style:{pointerEvents:"auto",touchAction:"manipulation"},title:e.title,onClick:a[0]||(a[0]=w(e=>t.$emit("click"),["stop"])),onTouchstart:a[1]||(a[1]=w(e=>t.$emit("click"),["stop","prevent"]))},[g("span",Ze,p(e.icon),1)],42,Je))};const et=ie({name:"InfoPopup",components:{PopupContainer:Ke,PopupButton:Xe},props:{isDarkMode:{type:Boolean,default:!1}},setup(){const{isOpen:e,togglePopup:a}=Qe("info","InfoPopup");return t(()=>{try{localStorage.getItem("hasSeenInfoPopup")||(a(!1),localStorage.setItem("hasSeenInfoPopup","true"))}catch(e){}}),{isOpen:e,togglePopup:a}}},[["render",function(e,t,a,o,r,l){const i=s("PopupContainer"),c=s("PopupButton");return n(),d(h,null,[f(i,{isOpen:o.isOpen,isDarkMode:a.isDarkMode,title:"About This Map",onClose:t[0]||(t[0]=e=>o.isOpen=!1)},{default:D(()=>t[1]||(t[1]=[g("p",null," This interactive map displays weekly water quality data collected by community scientists through the NYC Water Quality Monitoring program. ",-1),g("br",null,null,-1),g("p",null," Each dot represents a sampling site across NYC's waterways, color-coded based on the presence of enterococcus bacteria—an indicator of water safety for recreational activities. ",-1),g("p",{class:"mt-2"},[g("span",{class:"text-green-500 font-medium"},"Green"),v(": < 35 MPN/100mL - Acceptable for swimming ")],-1),g("p",{class:"mt-1"},[g("span",{class:"text-yellow-400 font-medium"},"Yellow"),v(": 35-104 MPN/100mL - Unacceptable if levels persist ")],-1),g("p",{class:"mt-1"},[g("span",{class:"text-red-500 font-medium"},"Red"),v(": > 104 MPN/100mL - Unacceptable for swimming ")],-1),g("p",{class:"mt-4 font-semibold"},"What does MPN mean?",-1),g("p",null," MPN stands for Most Probable Number — it's a way of estimating the number of bacteria in a water sample. Higher MPN values suggest more contamination and a higher risk for swimmers. Levels above 104 MPN/100mL are typically considered unsafe for recreational water. ",-1)])),_:1,__:[1]},8,["isOpen","isDarkMode"]),f(c,{isDarkMode:a.isDarkMode,icon:"i",title:"Information",onClick:o.togglePopup},null,8,["isDarkMode","onClick"])],64)}]]),tt={name:"DataInfoPopup",components:{PopupContainer:Ke,PopupButton:Xe},props:{isDarkMode:{type:Boolean,default:!1},showNotification:{type:Boolean,default:!1}},setup(e){const{isOpen:t,togglePopup:a}=Qe("data-info","DataInfoPopup","click_data_info_button");return{isOpen:t,togglePopup:a,trackOutbound:e=>{try{q(T,{url:e})}catch(t){}},showNotification:M(e,"showNotification")}}},at={class:"mt-2"};const ot=ie(tt,[["render",function(e,t,a,o,r,l){const i=s("PopupContainer"),c=s("PopupButton");return n(),d(h,null,[f(i,{isOpen:o.isOpen,isDarkMode:a.isDarkMode,title:"About the Data",onClose:t[1]||(t[1]=e=>o.isOpen=!1)},{default:D(()=>[t[4]||(t[4]=g("p",{class:"font-semibold mb-2"},"Why heavy rain leads to poor water quality samples:",-1)),t[5]||(t[5]=g("p",null," When it rains heavily, New York City's sewer system—which combines sewage and stormwater in the same pipes—can become overwhelmed. To prevent backups into homes and streets, this excess mixture is discharged directly into waterways like Newtown Creek and the East River through Combined Sewer Overflows (CSOs). These overflows carry untreated sewage, bacteria, and other pollutants into the water, significantly reducing water quality. That's why samples collected after major rain events often show poor results. ",-1)),t[6]||(t[6]=g("p",{class:"mt-2 font-semibold mb-2"},"Where our rainfall and tide data come from:",-1)),t[7]||(t[7]=g("p",null," Rainfall data is sourced from NOAA's National Weather Service, specifically from the Central Park weather station. This provides a consistent benchmark for citywide precipitation. ",-1)),t[8]||(t[8]=g("br",null,null,-1)),t[9]||(t[9]=g("p",null," Tide data comes from NOAA's tide predictions, using the Battery (NY) tidal station as a reference. Tidal stage helps us understand how water is moving through the estuary, which affects how pollutants disperse. ",-1)),g("p",at,[t[2]||(t[2]=v(" View the detailed dataset ")),g("a",{href:"https://docs.google.com/spreadsheets/d/12wNiul0QSymg3gO9OdwKkvAms-iHkz2i0hyxl6AP8eQ/edit?gid=0#gid=0",target:"_blank",rel:"noopener",onClick:t[0]||(t[0]=e=>o.trackOutbound("https://docs.google.com/spreadsheets/d/12wNiul0QSymg3gO9OdwKkvAms-iHkz2i0hyxl6AP8eQ/edit?gid=0#gid=0"))},"here"),t[3]||(t[3]=v(". "))])]),_:1,__:[4,5,6,7,8,9]},8,["isOpen","isDarkMode"]),f(c,{isDarkMode:a.isDarkMode,icon:"?",title:"Data information",variant:"notification",showNotification:o.showNotification,onClick:o.togglePopup},null,8,["isDarkMode","showNotification","onClick"])],64)}]]),st={name:"DonatePopup",components:{PopupContainer:Ke,PopupButton:Xe},props:{isDarkMode:{type:Boolean,default:!1}},setup(){const{isOpen:e,togglePopup:t}=Qe("donate","DonatePopup","click_donate_button");return{isOpen:e,togglePopup:t,trackOutbound:e=>{try{q(T,{url:e})}catch(t){}}}}},nt={class:"list-disc pl-5"};const rt=ie(st,[["render",function(e,t,a,o,r,l){const i=s("PopupContainer"),c=s("PopupButton");return n(),d(h,null,[f(i,{isOpen:o.isOpen,isDarkMode:a.isDarkMode,title:"Support the Project",onClose:t[2]||(t[2]=e=>o.isOpen=!1)},{default:D(()=>[t[3]||(t[3]=g("p",{class:"mb-2"},"Help expand water quality monitoring by donating or volunteering.",-1)),g("ul",nt,[g("li",null,[g("a",{href:"https://www.billionoysterproject.org/donate",target:"_blank",rel:"noopener",onClick:t[0]||(t[0]=e=>o.trackOutbound("https://www.billionoysterproject.org/donate"))},"Billion Oyster Project")]),g("li",null,[g("a",{href:"https://www.newtowncreekalliance.org/donate/",target:"_blank",rel:"noopener",onClick:t[1]||(t[1]=e=>o.trackOutbound("https://www.newtowncreekalliance.org/donate/"))},"Newtown Creek Alliance")])])]),_:1,__:[3]},8,["isOpen","isDarkMode"]),f(c,{isDarkMode:a.isDarkMode,icon:"$",title:"Donate",onClick:o.togglePopup},null,8,["isDarkMode","onClick"])],64)}]]),lt=i({__name:"TrendsButton",props:{isDarkMode:{type:Boolean,default:!1}},setup(e){const t=m(),a=()=>{t.push("/trends")};return(e,t)=>(n(),d("button",{class:c(["rounded-full w-10 h-10 flex items-center justify-center shadow-lg transition-colors duration-300 pointer-events-auto touch-action-manipulation",e.isDarkMode?"bg-gray-800 text-gray-200 hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-100"]),style:{pointerEvents:"auto",touchAction:"manipulation"},"aria-label":"Trends",onClick:a,onTouchstart:w(a,["stop","prevent"])},t[0]||(t[0]=[g("span",{class:"font-semibold text-lg pointer-events-none"},"📊",-1)]),34))}}),it=i({__name:"HomeButton",props:{isDarkMode:{type:Boolean,default:!1}},setup(e){const t=m(),a=()=>{t.push("/")};return(e,t)=>(n(),d("button",{class:c(["rounded-full w-10 h-10 flex items-center justify-center shadow-lg transition-colors duration-300 pointer-events-auto touch-action-manipulation",e.isDarkMode?"bg-gray-800 text-gray-200 hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-100"]),style:{pointerEvents:"auto",touchAction:"manipulation"},"aria-label":"Home",onClick:a,onTouchstart:w(a,["stop","prevent"])},t[0]||(t[0]=[g("span",{class:"font-semibold text-lg pointer-events-none"},"🏠",-1)]),34))}});function dt(t){const a=e(null),o=e(null),s=e(!1),n=e(null);return{data:a,metadata:o,loading:s,error:n,load:async function(e=u(t)){if(!e)return void(n.value="No date provided");n.value=null,s.value=!0;const r=`staticData-${e}`;try{const e="undefined"!=typeof sessionStorage&&sessionStorage.getItem(r);if(e){const t=JSON.parse(e);return a.value=t.geojson,o.value=t.metadata,void(s.value=!1)}}catch(l){}try{const t=`${I}/data/${e}/enriched.geojson`,s=`${I}/data/${e}/metadata.json`,[n,i]=await Promise.all([fetch(t),fetch(s)]);if(!n.ok)throw new Error(`Failed to fetch GeoJSON: ${n.status}`);if(!i.ok)throw new Error(`Failed to fetch metadata: ${i.status}`);const d=await n.json(),c=await i.json();a.value=d,o.value=c;try{"undefined"!=typeof sessionStorage&&sessionStorage.setItem(r,JSON.stringify({geojson:d,metadata:c}))}catch(l){}}catch(l){n.value=l instanceof Error?l.message:"An unknown error occurred",a.value=null,o.value=null}finally{s.value=!1}}}}const ct={key:0},ut={class:"absolute top-2 left-2 z-10 space-y-2"},pt={class:"fixed bottom-[calc(1rem+env(safe-area-inset-bottom,0px))] inset-x-0 flex flex-nowrap overflow-x-auto scrollbar-stable justify-center gap-4 px-4 z-[300]"},mt={key:0,class:"text-lg"},gt={key:1,class:"text-red-500"},ft={class:"text-lg"},vt={class:"mt-2"},yt={key:2,class:"text-lg"},ht={__name:"index",setup(a){const s=m(),i=e(z),v=e([]),{data:h,metadata:x,loading:b,error:k,load:w}=dt(i),D=r(()=>{if(!h.value||!Array.isArray(h.value.features))return 0;const e=h.value.features.length;if(0===e)return 0;return h.value.features.filter(e=>Number(e.properties.mpn)>104).length/e*100}),M=r(()=>D.value>50);return t(async()=>{try{const e=I,t=await fetch(`${e}/data/dates.json`);if(t.ok){const e=await t.json();v.value=Array.isArray(e)?e.sort():[]}}catch(e){}await w()}),l(i,e=>{e!==z&&s.replace(`/${e}`),w(e)}),(e,t)=>{var a;return n(),d("div",null,[f(U,{isDarkMode:u(F)},null,8,["isDarkMode"]),u(h)&&u(x)?(n(),d("div",ct,[u(He)?y("",!0):(n(),o(We,{key:0,dates:v.value,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),isDarkMode:u(F)},null,8,["dates","modelValue","isDarkMode"])),g("div",ut,[f(qe,{samples:u(h).features,isDarkMode:u(F)},null,8,["samples","isDarkMode"]),f(_e,{selectedDate:i.value,isDarkMode:u(F),rainfallData:(null==(a=u(h).features[0])?void 0:a.properties.rainByDay)||[]},null,8,["selectedDate","isDarkMode","rainfallData"])]),f(ke,{selectedDate:i.value,isDarkMode:u(F),geojson:u(h)},null,8,["selectedDate","isDarkMode","geojson"]),g("div",pt,[f(it,{isDarkMode:u(F)},null,8,["isDarkMode"]),f(et,{isDarkMode:u(F)},null,8,["isDarkMode"]),f(ot,{isDarkMode:u(F),showNotification:M.value},null,8,["isDarkMode","showNotification"]),f(rt,{isDarkMode:u(F)},null,8,["isDarkMode"]),f(lt,{isDarkMode:u(F)},null,8,["isDarkMode"])])])):(n(),d("div",{key:1,class:c(["text-center h-screen flex items-center justify-center flex-col",u(F)?"bg-gray-800 text-gray-100":"bg-white text-gray-900"])},[u(b)?(n(),d("div",mt,"Loading water quality data...")):u(k)?(n(),d("div",gt,[g("p",ft,"Error: "+p(u(k)),1),g("p",vt,"Could not load data for "+p(i.value),1)])):(n(),d("div",yt,"No data available"))],2))])}}},xt={key:0},bt={class:"absolute top-2 left-2 z-10 space-y-2"},kt={class:"fixed bottom-[calc(1rem+env(safe-area-inset-bottom,0px))] inset-x-0 flex flex-nowrap overflow-x-auto scrollbar-stable justify-center gap-4 px-4 z-[300]"},wt={key:0,class:"text-lg"},Dt={key:1,class:"text-red-500"},Mt={class:"text-lg"},Nt={class:"mt-2"},Pt={key:2,class:"text-lg"},Ct={__name:"[date]",setup(a){const s=N();m();const i=e(s.params.date),v=e([]),{data:h,metadata:x,loading:b,error:k,load:w}=dt(i),D=r(()=>{if(!h.value||!Array.isArray(h.value.features))return 0;const e=h.value.features.length;if(0===e)return 0;return h.value.features.filter(e=>Number(e.properties.mpn)>104).length/e*100}),M=r(()=>D.value>50);return t(async()=>{try{const e=I,t=await fetch(`${e}/data/dates.json`);if(t.ok){const e=await t.json();v.value=Array.isArray(e)?e.sort():[]}}catch(e){}await w()}),l(()=>s.params.date,e=>{e&&(i.value=e,w(e))}),(e,t)=>{var a;return n(),d("div",null,[f(U,{isDarkMode:u(F)},null,8,["isDarkMode"]),u(h)&&u(x)?(n(),d("div",xt,[u(He)?y("",!0):(n(),o(We,{key:0,dates:v.value,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),isDarkMode:u(F)},null,8,["dates","modelValue","isDarkMode"])),g("div",bt,[f(qe,{samples:u(h).features,isDarkMode:u(F)},null,8,["samples","isDarkMode"]),f(_e,{selectedDate:i.value,isDarkMode:u(F),rainfallData:(null==(a=u(h).features[0])?void 0:a.properties.rainByDay)||[]},null,8,["selectedDate","isDarkMode","rainfallData"])]),f(ke,{selectedDate:i.value,isDarkMode:u(F),geojson:u(h)},null,8,["selectedDate","isDarkMode","geojson"]),g("div",kt,[f(it,{isDarkMode:u(F)},null,8,["isDarkMode"]),f(et,{isDarkMode:u(F)},null,8,["isDarkMode"]),f(ot,{isDarkMode:u(F),showNotification:M.value},null,8,["isDarkMode","showNotification"]),f(rt,{isDarkMode:u(F)},null,8,["isDarkMode"]),f(lt,{isDarkMode:u(F)},null,8,["isDarkMode"])])])):(n(),d("div",{key:1,class:c(["text-center h-screen flex items-center justify-center flex-col",u(F)?"bg-gray-800 text-gray-100":"bg-white text-gray-900"])},[u(b)?(n(),d("div",wt,"Loading water quality data...")):u(k)?(n(),d("div",Dt,[g("p",Mt,"Error: "+p(u(k)),1),g("p",Nt,"Could not load data for "+p(i.value),1)])):(n(),d("div",Pt,"No data available"))],2))])}}},St={class:"heatmap-container"},_t={class:"date-cell"},$t=["title"],jt=["title"],Ot=ie({__name:"RainfallSampleTrend",props:{history:{type:Array,required:!0},isDarkMode:{type:Boolean,default:!1}},setup(e){const t=e=>{if(e<=35){return`hsl(140, 70%, ${75-25*(e/35)}%)`}if(e<=104){const t=(e-35)/69;return`hsl(${140-110*t}, 80%, ${70-15*t}%)`}{const t=Math.min((e-104)/200,1);return`hsl(${30-25*t}, 85%, ${55-10*t}%)`}};return(a,o)=>(n(),d("div",St,[g("div",{class:c(["correlation-info",{"dark-mode":e.isDarkMode}])},o[0]||(o[0]=[g("div",{class:"info-icon"},"📊",-1),g("div",{class:"info-content"},[g("strong",null,"Key Finding: Location Matters More Than Rain"),g("p",null,[v("Statistical analysis reveals that "),g("strong",null,"WHERE you swim matters 3x more than WHEN"),v(" (after rain). Location explains 20.5% of water quality variance while rainfall only explains 6.9%. Some sites are chronically polluted due to poor water circulation, nearby outfalls, or wildlife, regardless of weather.")])],-1)]),2),o[1]||(o[1]=g("div",{class:"heatmap-grid"},[g("div",{class:"header-cell"},"Date"),g("div",{class:"header-cell"},"Rain (1-2 days prior)"),g("div",{class:"header-cell"},"Avg Water Quality (MPN)")],-1)),(n(!0),d(h,null,x(e.history,e=>{return n(),d("div",{key:e.date,class:"heatmap-grid data-row"},[g("div",_t,p((o=e.date,new Date(o+"T00:00:00Z").toLocaleDateString("en-US",{month:"short",day:"numeric"}))),1),g("div",{class:"value-cell rainfall-cell",style:b({backgroundColor:(a=e.recent2DayRainfall,`hsl(210, 100%, ${85-50*Math.min(a/2,1)}%)`)}),title:`${e.recent2DayRainfall.toFixed(2)} inches in 1-2 days before sampling`},p(e.recent2DayRainfall.toFixed(2))+"″ ",13,$t),g("div",{class:"value-cell mpn-cell",style:b({backgroundColor:t(e.avgMpn)}),title:`Average MPN: ${Math.round(e.avgMpn)}`},p(Math.round(e.avgMpn)),13,jt)]);var a,o}),128)),o[2]||(o[2]=P('<div class="legend" data-v-d03a3d01><div class="legend-section" data-v-d03a3d01><div class="legend-title" data-v-d03a3d01>Rainfall 1-2 days before sampling (inches)</div><div class="legend-gradient" data-v-d03a3d01><div class="gradient-bar rainfall-gradient" data-v-d03a3d01></div><div class="gradient-labels" data-v-d03a3d01><span data-v-d03a3d01>0</span><span data-v-d03a3d01>2.0+</span></div></div></div><div class="legend-section" data-v-d03a3d01><div class="legend-title" data-v-d03a3d01>Average Water Quality (MPN bacteria count)</div><div class="legend-gradient" data-v-d03a3d01><div class="gradient-bar mpn-gradient" data-v-d03a3d01></div><div class="gradient-labels" data-v-d03a3d01><span data-v-d03a3d01>Good (0-35)</span><span data-v-d03a3d01>Unsafe (200+)</span></div></div></div></div>',1))]))}},[["__scopeId","data-v-d03a3d01"]]),At={class:"min-h-screen bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200"},Lt={class:"max-w-screen-lg mx-auto px-4 pt-14 pb-24 text-center"},Bt={key:0,class:"text-center py-10"},Et={key:1,class:"overflow-x-auto"},Tt={key:2,class:"mt-8 max-w-screen-lg mx-auto"},Rt={class:"grid md:grid-cols-2 gap-6"},Vt={class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800"},qt={class:"space-y-2 text-sm"},It={class:"font-medium text-gray-900 dark:text-gray-100"},zt={class:"text-xs text-gray-600 dark:text-gray-400"},Ft={key:0,class:"ml-1 text-red-600 dark:text-red-400"},Wt={class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},Ut={class:"space-y-2 text-sm"},Ht={class:"font-medium text-gray-900 dark:text-gray-100"},Qt={class:"text-xs text-gray-600 dark:text-gray-400"},Yt={key:0,class:"ml-1 text-green-600 dark:text-green-400"},Gt={class:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 flex gap-3"},Kt={__name:"trends",setup(a){const o=e([]),r=e(!0),l=e([]);return t(async()=>{try{const e=I,t=await fetch(`${e}/data/dates.json`),a=await t.json()||[],s=(await Promise.all(a.map(async t=>{var a;const o=await fetch(`${e}/data/${t}/enriched.geojson`);if(!o.ok)return null;const s=await o.json(),n={good:0,caution:0,unsafe:0};let r=0,l=0;for(const e of s.features){const t=Number(e.properties.mpn);isNaN(t)||(r+=t,l++),t<35?n.good++:t<=104?n.caution++:n.unsafe++}const i=(null==(a=s.features[0])?void 0:a.properties.rainByDay)||[],d=i.reduce((e,t)=>e+t,0),c=i.length>=2?i.slice(-2).reduce((e,t)=>e+t,0):d;return{date:t,rainfallByDay:i,sampleSummary:n,totalRainfall:d,recent2DayRainfall:c,avgMpn:l>0?r/l:0}}))).filter(Boolean);o.value=s.sort((e,t)=>e.date.localeCompare(t.date));const n=new Map;for(const o of s){const t=await fetch(`${e}/data/${o.date}/enriched.geojson`);if(!t.ok)continue;const a=await t.json();for(const e of a.features){const t=e.properties.siteName,a=Number(e.properties.mpn);t&&!isNaN(a)&&(n.has(t)||n.set(t,[]),n.get(t).push(a))}}const r=Array.from(n.entries()).map(([e,t])=>{const a=t.reduce((e,t)=>e+t,0)/t.length,o=[...t].sort((e,t)=>e-t),s=o[Math.floor(o.length/2)],n=t.filter(e=>e>104).length,r=t.filter(e=>e<=35).length;return{siteName:e,avgMpn:a,medianMpn:s,samples:t.length,consistentlyUnsafe:n/t.length>=.75,consistentlyGood:r/t.length>=.75}});r.sort((e,t)=>t.avgMpn-e.avgMpn),l.value=r}catch(e){}finally{r.value=!1}}),(e,t)=>{const a=s("router-link");return n(),d("div",At,[g("div",Lt,[f(U,{isDarkMode:u(F)},null,8,["isDarkMode"]),t[5]||(t[5]=g("h1",{class:"text-2xl font-bold mb-6 text-gray-900 dark:text-white"}," Trends: Rainfall vs Water Quality ",-1)),r.value?(n(),d("div",Bt,"Loading…")):(n(),d("div",Et,[f(Ot,{history:o.value,isDarkMode:u(F)},null,8,["history","isDarkMode"])])),t[6]||(t[6]=g("p",{class:"text-base text-gray-700 dark:text-gray-300 mt-6 max-w-prose mx-auto"},[v(" This heatmap shows how recent rainfall relates to citywide average water quality. While there's a moderate correlation, "),g("strong",null,"individual location matters much more"),v(". Some sites are consistently unsafe due to poor circulation, nearby outfalls, or wildlife—regardless of weather. ")],-1)),l.value.length>0?(n(),d("div",Tt,[t[2]||(t[2]=g("h2",{class:"text-xl font-bold mb-4 text-gray-900 dark:text-white"},"📍 Best & Worst Locations",-1)),g("div",Rt,[g("div",Vt,[t[0]||(t[0]=g("h3",{class:"font-semibold text-red-900 dark:text-red-200 mb-3 flex items-center gap-2"},[g("span",null,"🚨"),v(" Avoid These Locations ")],-1)),g("div",qt,[(n(!0),d(h,null,x(l.value.slice(0,5),(e,t)=>(n(),d("div",{key:e.siteName,class:"text-left"},[g("div",It,p(t+1)+". "+p(e.siteName),1),g("div",zt,[v(" Avg MPN: "+p(Math.round(e.avgMpn))+" ",1),e.consistentlyUnsafe?(n(),d("span",Ft,"(always unsafe)")):y("",!0)])]))),128))])]),g("div",Wt,[t[1]||(t[1]=g("h3",{class:"font-semibold text-green-900 dark:text-green-200 mb-3 flex items-center gap-2"},[g("span",null,"✅"),v(" Consistently Safe Locations ")],-1)),g("div",Ut,[(n(!0),d(h,null,x(l.value.slice(-5).reverse(),(e,t)=>(n(),d("div",{key:e.siteName,class:"text-left"},[g("div",Ht,p(t+1)+". "+p(e.siteName),1),g("div",Qt,[v(" Avg MPN: "+p(Math.round(e.avgMpn))+" ",1),e.consistentlyGood?(n(),d("span",Yt,"(always safe)")):y("",!0)])]))),128))])])])])):y("",!0),t[7]||(t[7]=g("div",{class:"text-sm text-gray-600 dark:text-gray-400 mt-6 max-w-prose mx-auto p-4 bg-blue-50 dark:bg-gray-800 rounded-lg border border-blue-200 dark:border-gray-700"},[g("strong",{class:"text-gray-900 dark:text-gray-100"},"💡 Takeaway:"),g("p",{class:"mt-2"},[v("Check your specific location on the map before swimming. Some spots like Hudson River piers are consistently safe, while others like Gowanus Canal or Newtown Creek are chronically polluted. Rain matters, but "),g("strong",null,"where you swim matters more"),v(".")])],-1)),g("div",Gt,[f(a,{to:"/"},{default:D(()=>t[3]||(t[3]=[g("button",{class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-black dark:text-white rounded-full shadow-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"}," 🏠 Home ",-1)])),_:1,__:[3]}),f(a,{to:"/map"},{default:D(()=>t[4]||(t[4]=[g("button",{class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-black dark:text-white rounded-full shadow-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"}," 📍 Map ",-1)])),_:1,__:[4]})])])])}}},Jt=C({history:S(`${I}/`),routes:[{path:"/",component:de},{path:"/index",component:ht},{path:"/map",redirect:`/${z}`},{path:"/:date",component:Ct},{path:"/trends",component:Kt}]});Jt.afterEach(()=>{q("$pageview")});const Zt=_(L);Zt.use(Jt),Zt.mount("#app"),setTimeout(()=>{const e=`${I}/data/${z}/enriched.geojson`,t=`${I}/data/${z}/metadata.json`;Promise.all([fetch(e).then(e=>e.ok?e.json():null),fetch(t).then(e=>e.ok?e.json():null)]).then(([e,t])=>{if(e&&t)try{sessionStorage.setItem(`staticData-${z}`,JSON.stringify({geojson:e,metadata:t}))}catch(a){}}).catch(e=>{})},100),setTimeout(()=>{V()},1e3);
