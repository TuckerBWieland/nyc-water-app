import{r as e,o as t,a,c as o,b as n,d as s,u as r,e as l,f as i,g as u,w as d,h as c,F as p,i as m,t as f,n as g,j as y,k as h,l as v,m as b,p as w,q as k,s as x,v as D,x as M,y as C,z as P,A as N,B as S,C as _,D as $,E as O}from"./vue-T0KkCfpt.js";import{r as A,g as j}from"./leaflet-DtqLV9Sc.js";import{C as B,a as T,L,B as E,b as I,P as R,p as q,c as V,d as z,e as U,f as F}from"./charts-B2Kdmyyk.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const W=e(!1);function Q(){W.value=window.innerWidth<768}const H={__name:"App",setup:e=>(t(()=>{Q(),window.addEventListener("resize",Q)}),a(()=>{window.removeEventListener("resize",Q)}),(e,t)=>{const a=n("router-view");return s(),o(a)})},Z={};let G;const Y="click_outbound_link";let K=!1;function J(e,t={}){try{if(!K||!G)return;G.capture(e,t)}catch(a){}}const X="/nyc-water-app",ee="2025-07-17",te={class:"h-screen flex items-center justify-center"},ae={__name:"index",setup(e){const a=r();return t(()=>{a.replace(`/${ee}`)}),(e,t)=>(s(),l("div",te,t[0]||(t[0]=[i("p",null,"If you see this page, the redirect failed.",-1)])))}};const oe=j(A()),ne=e(!1),se=35,re=104,le=24196,ie="#22c55e",ue="#facc15",de="#ef4444";function ce(e){const t=function(e){if(null===e)return ue;const t=Number(e);return Number.isNaN(t)?ue:t<se?ie:t<=re?ue:de}(e);return oe.divIcon({html:`\n      <div style="width: 16px; height: 32px; color: ${t}">\n        <svg viewBox="0 0 32 64" xmlns="http://www.w3.org/2000/svg" width="16" height="32">\n          <rect x="8" y="2" width="16" height="6" rx="2" fill="#ccc" stroke="black" stroke-width="0.5"/>\n          <rect x="10" y="8" width="12" height="4" rx="2" fill="#eee" stroke="black" stroke-width="0.5"/>\n          <rect x="6" y="12" width="20" height="44" rx="6" fill="currentColor" stroke="white" stroke-width="1"/>\n          <ellipse cx="16" cy="58" rx="8" ry="2" fill="white" opacity="0.2"/>\n        </svg>\n      </div>\n    `,className:"water-bottle-icon",iconSize:[16,32],iconAnchor:[8,32],popupAnchor:[0,-34]})}function pe(e,t){const a=["F","S","S","M","T","W","Th"],o=(e||[]).filter(e=>"number"==typeof e&&!Number.isNaN(e)),n=o.length?Math.max(...o):0;return`\n    <div class="flex items-end justify-between h-16 mb-1">\n      ${e.map((e,o)=>{const s=0===n||null===e?0:e/n*100,r=e&&e>0?Number(e).toFixed(1):"";return`\n            <div class="flex flex-col items-center group h-full justify-end">\n              <div class="text-xs opacity-70 mb-1 font-medium" style="${r?"":"visibility:hidden"}">${r}</div>\n              <div class="w-4 rounded-t transition-all duration-300 shadow-md border border-black/10 min-h-[1px] ${l=e,null==l?t?"bg-gray-500":"bg-gray-300":l<.5?t?"bg-green-600":"bg-green-500":l<3?t?"bg-yellow-500":"bg-yellow-400":t?"bg-red-600":"bg-red-500"}" style="height:${s}%"></div>\n              <span class="text-xs mt-1 font-medium">${a[o%7]}</span>\n            </div>`;var l}).join("")}\n    </div>`}function me(e){const t=new Date(e),a=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`Sampled on ${t.getMonth()+1}/${t.getDate()} at ${a}`}const fe={class:"w-full h-full"},ge=u({__name:"MapViewer",props:{selectedDate:{},isDarkMode:{type:Boolean,default:!1},geojson:{default:null}},setup(o){const n=o,r=e(null),u=e([]),c=e(null),p=e(!1),m=()=>function({map:e,tileLayer:t,markers:a,isDarkMode:o}){if(!e.value)return;t.value&&e.value.removeLayer(t.value);const n=o?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png";t.value=oe.tileLayer(n,{attribution:"",maxZoom:19,subdomains:"abcd"}).addTo(e.value),function({map:e,markers:t,isDarkMode:a}){e.value&&t.value.forEach(e=>{const t=e.getPopup();if(t){const o=t.getContent();e.closePopup().unbindPopup(),e.bindPopup(o||"",{className:a?"dark-mode-popup":""})}})}({map:e,markers:a,isDarkMode:o})}({map:r,tileLayer:c,markers:u,isDarkMode:n.isDarkMode}),f=e=>function({map:e,markers:t,hasAutoFitted:a,isDarkMode:o,data:n}){if(!e.value)return;const s=e.value.getCenter(),r=e.value.getZoom();for(const i of t.value)i.remove();if(t.value=[],n.features&&0!==n.features.length){for(const a of n.features)try{if(!a.geometry||!a.geometry.coordinates||a.geometry.coordinates.length<2)continue;if(!a.properties)continue;const n=a.properties.siteName||"",s=a.properties.mpn,r=a.properties.timestamp||"";if(void 0===s)continue;const[l,i]=a.geometry.coordinates;if(isNaN(i)||isNaN(l))continue;const u=ce(s);let d,c;u.options.popupAnchor=[0,-40];const p=Number(s);p<35?(d="text-green-500",c="Acceptable for swimming"):p<=104?(d="text-yellow-400",c="Unacceptable if levels persist"):(d="text-red-500",c="Unacceptable for swimming");const m=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),f=m(n),g=m(null===s?"N/A":s.toString()),y=Number(s)===le;let h=`\n        <div class="site-popup">\n          <div class="font-semibold text-lg site-name">${f}</div>\n          <div class="mt-2 ${d} font-medium text-base">\n            ${g}${y?"*":""} MPN/100mL\n          </div>\n          <div class="mt-1 text-sm opacity-75">\n            ${c}\n          </div>\n      `;if(y&&(h+='<div class="text-xs opacity-75 mt-1">*Sample reached the instrument detection limit.</div>'),r&&(h+=`<div class="text-xs opacity-75 mt-1">${m(me(r))}</div>`),(a.properties.tide||void 0!==a.properties.rainfall_mm_7day)&&(h+='<div class="text-xs font-medium mt-3 pt-2 border-t border-gray-200">Environmental Conditions:</div>'),a.properties.tide&&(h+=`<div class="text-xs opacity-75 mt-1"><span title="Tidal data is taken from nearest NOAA station and is only approximate">${m(a.properties.tide)}</span></div>`),void 0!==a.properties.rainfall_mm_7day&&null!==a.properties.rainfall_mm_7day){const e=a.properties.rainfall_mm_7day||0,t=m(Number((.0393701*e).toFixed(2)).toFixed(2));if(W.value){const e=a.properties.rainByDay||[];h+=`<div class="text-xs opacity-75 mt-1">Total rainfall (7-day): ${t} in</div>`,h+='<button class="rain-toggle text-xs underline mt-1">Rain details</button>',h+=`<div class="rain-details hidden mt-1">${pe(e,o)}</div>`}else h+=`<div class="text-xs opacity-75 mt-1"><span title="Rainfall data for the 7 days prior to sample date">Rainfall: ${t} in (7-day)</span></div>`}if(void 0!==a.properties.goodCount&&void 0!==a.properties.cautionCount&&void 0!==a.properties.poorCount){const e=m(a.properties.goodCount),t=m(a.properties.cautionCount),o=m(a.properties.poorCount);h+='<div class="text-xs font-medium mt-3 pt-2 border-t border-gray-200">This season:</div>',h+=`<div class="text-xs opacity-75 mt-1">${e} good, ${t} caution, ${o} poor</div>`}h+="</div>";const v=oe.marker([i,l],{icon:u}).bindPopup(h,{className:o?"dark-mode-popup":""}).addTo(e.value);v.on("click",()=>{J("click_site_marker",{site_name:n})}),v.on("popupopen",e=>{ne.value=!0;const t=e.popup.getElement(),a=null==t?void 0:t.querySelector(".rain-toggle");a&&a.addEventListener("click",()=>{const e=null==t?void 0:t.querySelector(".rain-details");e&&e.classList.toggle("hidden")})}),v.on("popupclose",()=>{ne.value=!1}),t.value.push(v)}catch(l){}if(t.value.length>0)if(a.value)e.value.setView(s,r);else{const o=oe.featureGroup(t.value);e.value.fitBounds(o.getBounds(),{padding:[30,30]}),a.value=!0}}}({map:r,markers:u,hasAutoFitted:p,isDarkMode:n.isDarkMode,data:e});return d(()=>n.isDarkMode,()=>m()),d(()=>n.geojson,e=>{e&&r.value&&f(e)},{immediate:!0}),t(()=>{r.value=oe.map("map").setView([40.7128,-74.006],12),m(),r.value.removeControl(r.value.zoomControl),n.geojson&&f(n.geojson)}),a(()=>{r.value&&r.value.remove()}),(e,t)=>(s(),l("div",fe,t[0]||(t[0]=[i("div",{id:"map",class:"absolute inset-0"},null,-1)])))}}),ye=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a},he=["F","S","S","M","T","W","Th"],ve={name:"RainDropLegend",props:{selectedDate:{type:String,required:!0},isDarkMode:{type:Boolean,default:!1},rainfallData:{type:Array,default:()=>[]}},setup(e){const t=y(()=>e.rainfallData&&e.rainfallData.length>0?e.rainfallData:[]),a=y(()=>t.value.reduce((e,t)=>e+(t||0),0)),o=y(()=>a.value.toFixed(2)),n=y(()=>t.value.length>0&&t.value.some(e=>null!=e&&e>=0));return{activeRainData:t,totalRainfall:a,totalRainfallValue:o,hasValidRainfallData:n,getBarColorClass:t=>null==t?e.isDarkMode?"bg-gray-500":"bg-gray-300":t<.5?e.isDarkMode?"bg-green-600":"bg-green-500":t<3?e.isDarkMode?"bg-yellow-500":"bg-yellow-400":e.isDarkMode?"bg-red-600":"bg-red-500",getDayLabel:e=>he[e%7],getBarHeight:e=>{const a=t.value.filter(e=>"number"==typeof e&&!Number.isNaN(e)),o=a.length?Math.max(...a):0;return 0===o?10:0===e?5:Math.max(e/o*100,10)},isMobile:W,featurePopupOpen:ne}}},be={class:"flex items-end justify-between h-16 mb-1"},we={key:0,class:"text-xs opacity-70 mb-1 font-medium"},ke=["title"],xe={class:"text-xs mt-1 font-medium"},De={class:"font-bold"};const Me=ye(ve,[["render",function(e,t,a,o,n,r){return o.isMobile&&o.featurePopupOpen||!o.hasValidRainfallData?c("",!0):(s(),l("div",{key:0,class:g(["rain-drop-legend p-3 rounded shadow-md",a.isDarkMode?"bg-gray-800 text-gray-200":"bg-white text-gray-800"])},[t[2]||(t[2]=i("h3",{class:"text-xs font-medium mb-2"},"7-Day Rainfall",-1)),i("div",be,[(s(!0),l(p,null,m(o.activeRainData,(e,t)=>(s(),l("div",{key:t,class:"flex flex-col items-center group h-full justify-end"},[e>0?(s(),l("div",we,f(e.toFixed(1)),1)):c("",!0),i("div",{class:g(["w-4 md:w-5 rounded-t transition-all duration-300 shadow-md border border-black/10 min-h-[1px]",o.getBarColorClass(e)]),style:h({height:`${o.getBarHeight(e)}%`}),title:`${null!=e?Number(e).toFixed(2):"No data"} inches`},null,14,ke),i("span",xe,f(o.getDayLabel(t)),1)]))),128))]),i("div",{class:g(["text-xs text-center mt-2 pt-2 border-t",a.isDarkMode?"border-gray-700":"border-gray-200"])},[t[0]||(t[0]=i("span",{class:"font-semibold"},"Total rainfall:",-1)),i("span",De,f(o.totalRainfallValue),1),t[1]||(t[1]=i("span",null,"in",-1))],2)],2))}],["__scopeId","data-v-71a941d4"]]),Ce={name:"SampleBarLegend",props:{samples:{type:Array,required:!0},isDarkMode:{type:Boolean,default:!1}},setup(e){const t=y(()=>e.samples.filter(e=>Number(e.properties.mpn)<35).length),a=y(()=>e.samples.filter(e=>{const t=Number(e.properties.mpn);return t>=35&&t<=104}).length),o=y(()=>e.samples.filter(e=>Number(e.properties.mpn)>104).length),n=y(()=>e.samples.length),s=y(()=>n.value>0?t.value/n.value*100:0),r=y(()=>n.value>0?a.value/n.value*100:0),l=y(()=>n.value>0?o.value/n.value*100:0);return{greenCount:t,yellowCount:a,redCount:o,totalCount:n,greenPercentage:s,yellowPercentage:r,redPercentage:l,isMobile:W,featurePopupOpen:ne}}},Pe={class:"w-full h-4 rounded-full overflow-hidden flex"},Ne=["title"],Se=["title"],_e=["title"],$e={class:"flex justify-between text-xs mt-1"},Oe={class:"flex items-center"},Ae={class:"flex items-center"},je={class:"flex items-center"},Be={class:"font-bold"};const Te=ye(Ce,[["render",function(e,t,a,o,n,r){return o.isMobile&&o.featurePopupOpen?c("",!0):(s(),l("div",{key:0,class:g(["sample-bar-legend p-2 rounded shadow-md",a.isDarkMode?"bg-gray-800 text-gray-200":"bg-white text-gray-800"])},[t[4]||(t[4]=i("h3",{class:"text-xs font-medium mb-1"},"Sample Quality",-1)),i("div",Pe,[o.greenCount>0?(s(),l("div",{key:0,class:"h-full bg-green-500 transition-all duration-500 ease-out",style:h({width:`${o.greenPercentage}%`}),title:`${o.greenCount} Good samples`},null,12,Ne)):c("",!0),o.yellowCount>0?(s(),l("div",{key:1,class:"h-full bg-yellow-400 transition-all duration-500 ease-out",style:h({width:`${o.yellowPercentage}%`}),title:`${o.yellowCount} Moderate samples`},null,12,Se)):c("",!0),o.redCount>0?(s(),l("div",{key:2,class:"h-full bg-red-500 transition-all duration-500 ease-out",style:h({width:`${o.redPercentage}%`}),title:`${o.redCount} Poor samples`},null,12,_e)):c("",!0)]),i("div",$e,[i("div",Oe,[t[0]||(t[0]=i("span",{class:"inline-block w-2 h-2 bg-green-500 rounded-full mr-1"},null,-1)),i("span",null,f(o.greenCount),1)]),i("div",Ae,[t[1]||(t[1]=i("span",{class:"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-1"},null,-1)),i("span",null,f(o.yellowCount),1)]),i("div",je,[t[2]||(t[2]=i("span",{class:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"},null,-1)),i("span",null,f(o.redCount),1)])]),i("div",{class:g(["text-xs text-center mt-2 pt-2 border-t",a.isDarkMode?"border-gray-700":"border-gray-200"])},[t[3]||(t[3]=i("span",{class:"font-semibold"},"Total sites:",-1)),i("span",Be,f(o.totalCount),1)],2)],2))}],["__scopeId","data-v-b3390d92"]]),Le={name:"DateScroller",props:{dates:{type:Array,required:!0},modelValue:{type:String,required:!0},isDarkMode:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=r(),o=y(()=>e.dates.indexOf(e.modelValue)),n=y(()=>o.value>0),s=y(()=>o.value<e.dates.length-1),l=y(()=>{if(!e.modelValue)return"";try{const[t,a,o]=e.modelValue.split("-").map(Number);return new Date(Date.UTC(t,a-1,o)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})}catch(t){return e.modelValue}});return{currentIndex:o,hasPrevious:n,hasNext:s,formattedModelValue:l,selectPrevious:()=>{if(n.value){const n=e.dates[o.value-1];t("update:modelValue",n),a.push({path:`/${n}`})}},selectNext:()=>{if(s.value){const n=e.dates[o.value+1];t("update:modelValue",n),a.push({path:`/${n}`})}}}}},Ee={class:"fixed bottom-[calc(6rem+env(safe-area-inset-bottom,0px))] left-1/2 transform -translate-x-1/2 z-[320]"},Ie={class:"px-2 text-center whitespace-nowrap"};const Re=ye(Le,[["render",function(e,t,a,o,n,r){return s(),l("div",Ee,[i("div",{class:g(["inline-flex items-center rounded-full px-6 py-3 shadow-md transition-colors duration-300",a.isDarkMode?"bg-gray-800 bg-opacity-90":"bg-white bg-opacity-90"])},[i("button",{class:g(["w-10 h-10 flex items-center justify-center mr-3 focus:outline-none transition-colors duration-300 text-xl",a.isDarkMode?"text-gray-300 hover:text-white":"text-gray-700 hover:text-black",{"opacity-0 pointer-events-none":!o.hasPrevious}]),"aria-label":"Previous date",onClick:t[0]||(t[0]=e=>o.hasPrevious&&o.selectPrevious())}," ← ",2),i("div",Ie,[i("span",{class:g(["font-semibold transition-colors duration-300 text-sm sm:text-lg",a.isDarkMode?"text-gray-200":"text-gray-800"])},f(o.formattedModelValue),3)]),i("button",{class:g(["w-10 h-10 flex items-center justify-center ml-3 focus:outline-none transition-colors duration-300 text-xl",a.isDarkMode?"text-gray-300 hover:text-white":"text-gray-700 hover:text-black",{"opacity-0 pointer-events-none":!o.hasNext}]),"aria-label":"Next date",onClick:t[1]||(t[1]=e=>o.hasNext&&o.selectNext())}," → ",2)],2)])}]]),qe=e(null),Ve=y(()=>null!==qe.value);function ze(e,t,a){const{isOpen:o,togglePopup:n,closePopup:s}=function(e){const t=y({get:()=>qe.value===e,set:t=>{t?qe.value=e:qe.value===e&&(qe.value=null)}});return{isOpen:t,togglePopup:()=>{t.value=!t.value},closePopup:()=>{qe.value===e&&(qe.value=null)}}}(e);return{isOpen:o,togglePopup:(e=!0)=>{try{const s=!o.value;n(),s&&e&&(J("open_popup",{component:t}),a&&J(a))}catch(s){n()}},closePopup:s}}const Ue={class:"flex justify-between items-center mb-2"},Fe={class:"font-bold"},We={__name:"PopupContainer",props:{isOpen:{type:Boolean,required:!0},isDarkMode:{type:Boolean,required:!0},title:{type:String,required:!0}},emits:["close"],setup(t,{emit:o}){const n=t,r=o,u=e(null),p=e=>{u.value&&!u.value.contains(e.target)&&r("close")};return d(()=>n.isOpen,e=>{e?document.addEventListener("click",p):document.removeEventListener("click",p)}),a(()=>{document.removeEventListener("click",p)}),(e,a)=>t.isOpen?(s(),l("div",{key:0,ref_key:"popupRef",ref:u,onClick:a[1]||(a[1]=b(()=>{},["stop"])),class:g(["fixed z-[400] bottom-[calc(4rem+env(safe-area-inset-bottom,0px))] left-1/2 transform -translate-x-1/2","p-4 sm:p-6 rounded-lg shadow-lg","max-h-[calc(100vh-6rem)] overflow-y-auto scrollbar-stable","w-full sm:w-[455px] max-w-[95vw]","transition-colors duration-300",t.isDarkMode?"bg-gray-800 text-white":"bg-white text-black"])},[i("div",Ue,[i("h3",Fe,f(t.title),1),i("button",{class:g(t.isDarkMode?"text-gray-400 hover:text-white":"text-gray-500 hover:text-gray-700"),onClick:a[0]||(a[0]=t=>e.$emit("close"))}," × ",2)]),i("div",{class:g(["prose text-sm",t.isDarkMode?"text-gray-300":"text-gray-700"])},[v(e.$slots,"default")],2)],2)):c("",!0)}},Qe=["title"],He={class:"font-semibold text-lg pointer-events-none"},Ze={__name:"PopupButton",props:{isDarkMode:{type:Boolean,required:!0},icon:{type:String,required:!0},title:{type:String,required:!0},variant:{type:String,default:"default",validator:e=>["default","notification"].includes(e)},showNotification:{type:Boolean,default:!1}},emits:["click"],setup:e=>(t,a)=>(s(),l("button",{class:g(["rounded-full w-10 h-10 flex items-center justify-center shadow-lg transition-colors duration-300 pointer-events-auto touch-action-manipulation","notification"===e.variant&&e.showNotification?"bg-orange-700 text-white hover:bg-orange-800":e.isDarkMode?"bg-gray-800 text-gray-200 hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-100"]),style:{pointerEvents:"auto",touchAction:"manipulation"},title:e.title,onClick:a[0]||(a[0]=b(e=>t.$emit("click"),["stop"])),onTouchstart:a[1]||(a[1]=b(e=>t.$emit("click"),["stop","prevent"]))},[i("span",He,f(e.icon),1)],42,Qe))};const Ge=ye({name:"InfoPopup",components:{PopupContainer:We,PopupButton:Ze},props:{isDarkMode:{type:Boolean,default:!1}},setup(){const{isOpen:e,togglePopup:a}=ze("info","InfoPopup");return t(()=>{try{localStorage.getItem("hasSeenInfoPopup")||(a(!1),localStorage.setItem("hasSeenInfoPopup","true"))}catch(e){}}),{isOpen:e,togglePopup:a}}},[["render",function(e,t,a,o,r,u){const d=n("PopupContainer"),c=n("PopupButton");return s(),l(p,null,[w(d,{isOpen:o.isOpen,isDarkMode:a.isDarkMode,title:"About This Map",onClose:t[0]||(t[0]=e=>o.isOpen=!1)},{default:k(()=>t[1]||(t[1]=[i("p",null," This interactive map displays weekly water quality data collected by community scientists through the NYC Water Quality Monitoring program. ",-1),i("br",null,null,-1),i("p",null," Each dot represents a sampling site across NYC's waterways, color-coded based on the presence of enterococcus bacteria—an indicator of water safety for recreational activities. ",-1),i("p",{class:"mt-2"},[i("span",{class:"text-green-500 font-medium"},"Green"),x(": < 35 MPN/100mL - Acceptable for swimming ")],-1),i("p",{class:"mt-1"},[i("span",{class:"text-yellow-400 font-medium"},"Yellow"),x(": 35-104 MPN/100mL - Unacceptable if levels persist ")],-1),i("p",{class:"mt-1"},[i("span",{class:"text-red-500 font-medium"},"Red"),x(": > 104 MPN/100mL - Unacceptable for swimming ")],-1),i("p",{class:"mt-4 font-semibold"},"What does MPN mean?",-1),i("p",null," MPN stands for Most Probable Number — it's a way of estimating the number of bacteria in a water sample. Higher MPN values suggest more contamination and a higher risk for swimmers. Levels above 104 MPN/100mL are typically considered unsafe for recreational water. ",-1)])),_:1,__:[1]},8,["isOpen","isDarkMode"]),w(c,{isDarkMode:a.isDarkMode,icon:"i",title:"Information",onClick:o.togglePopup},null,8,["isDarkMode","onClick"])],64)}]]),Ye={name:"DataInfoPopup",components:{PopupContainer:We,PopupButton:Ze},props:{isDarkMode:{type:Boolean,default:!1},showNotification:{type:Boolean,default:!1}},setup(e){const{isOpen:t,togglePopup:a}=ze("data-info","DataInfoPopup","click_data_info_button");return{isOpen:t,togglePopup:a,trackOutbound:e=>{try{J(Y,{url:e})}catch(t){}},showNotification:D(e,"showNotification")}}},Ke={class:"mt-2"};const Je=ye(Ye,[["render",function(e,t,a,o,r,u){const d=n("PopupContainer"),c=n("PopupButton");return s(),l(p,null,[w(d,{isOpen:o.isOpen,isDarkMode:a.isDarkMode,title:"About the Data",onClose:t[1]||(t[1]=e=>o.isOpen=!1)},{default:k(()=>[t[4]||(t[4]=i("p",{class:"font-semibold mb-2"},"Why heavy rain leads to poor water quality samples:",-1)),t[5]||(t[5]=i("p",null," When it rains heavily, New York City's sewer system—which combines sewage and stormwater in the same pipes—can become overwhelmed. To prevent backups into homes and streets, this excess mixture is discharged directly into waterways like Newtown Creek and the East River through Combined Sewer Overflows (CSOs). These overflows carry untreated sewage, bacteria, and other pollutants into the water, significantly reducing water quality. That's why samples collected after major rain events often show poor results. ",-1)),t[6]||(t[6]=i("p",{class:"mt-2 font-semibold mb-2"},"Where our rainfall and tide data come from:",-1)),t[7]||(t[7]=i("p",null," Rainfall data is sourced from NOAA's National Weather Service, specifically from the Central Park weather station. This provides a consistent benchmark for citywide precipitation. ",-1)),t[8]||(t[8]=i("br",null,null,-1)),t[9]||(t[9]=i("p",null," Tide data comes from NOAA's tide predictions, using the Battery (NY) tidal station as a reference. Tidal stage helps us understand how water is moving through the estuary, which affects how pollutants disperse. ",-1)),i("p",Ke,[t[2]||(t[2]=x(" View the detailed dataset ")),i("a",{href:"https://docs.google.com/spreadsheets/d/12wNiul0QSymg3gO9OdwKkvAms-iHkz2i0hyxl6AP8eQ/edit?gid=0#gid=0",target:"_blank",rel:"noopener",onClick:t[0]||(t[0]=e=>o.trackOutbound("https://docs.google.com/spreadsheets/d/12wNiul0QSymg3gO9OdwKkvAms-iHkz2i0hyxl6AP8eQ/edit?gid=0#gid=0"))},"here"),t[3]||(t[3]=x(". "))])]),_:1,__:[4,5,6,7,8,9]},8,["isOpen","isDarkMode"]),w(c,{isDarkMode:a.isDarkMode,icon:"?",title:"Data information",variant:"notification",showNotification:o.showNotification,onClick:o.togglePopup},null,8,["isDarkMode","showNotification","onClick"])],64)}]]),Xe={name:"DonatePopup",components:{PopupContainer:We,PopupButton:Ze},props:{isDarkMode:{type:Boolean,default:!1}},setup(){const{isOpen:e,togglePopup:t}=ze("donate","DonatePopup","click_donate_button");return{isOpen:e,togglePopup:t,trackOutbound:e=>{try{J(Y,{url:e})}catch(t){}}}}},et={class:"list-disc pl-5"};const tt=ye(Xe,[["render",function(e,t,a,o,r,u){const d=n("PopupContainer"),c=n("PopupButton");return s(),l(p,null,[w(d,{isOpen:o.isOpen,isDarkMode:a.isDarkMode,title:"Support the Project",onClose:t[2]||(t[2]=e=>o.isOpen=!1)},{default:k(()=>[t[3]||(t[3]=i("p",{class:"mb-2"},"Help expand water quality monitoring by donating or volunteering.",-1)),i("ul",et,[i("li",null,[i("a",{href:"https://www.billionoysterproject.org/donate",target:"_blank",rel:"noopener",onClick:t[0]||(t[0]=e=>o.trackOutbound("https://www.billionoysterproject.org/donate"))},"Billion Oyster Project")]),i("li",null,[i("a",{href:"https://www.newtowncreekalliance.org/donate/",target:"_blank",rel:"noopener",onClick:t[1]||(t[1]=e=>o.trackOutbound("https://www.newtowncreekalliance.org/donate/"))},"Newtown Creek Alliance")])])]),_:1,__:[3]},8,["isOpen","isDarkMode"]),w(c,{isDarkMode:a.isDarkMode,icon:"$",title:"Donate",onClick:o.togglePopup},null,8,["isDarkMode","onClick"])],64)}]]),at=u({__name:"TrendsButton",props:{isDarkMode:{type:Boolean,default:!1}},setup(e){const t=r(),a=()=>{t.push("/trends")};return(e,t)=>(s(),l("button",{class:g(["rounded-full w-10 h-10 flex items-center justify-center shadow-lg transition-colors duration-300 pointer-events-auto touch-action-manipulation",e.isDarkMode?"bg-gray-800 text-gray-200 hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-100"]),style:{pointerEvents:"auto",touchAction:"manipulation"},"aria-label":"Trends",onClick:a,onTouchstart:b(a,["stop","prevent"])},t[0]||(t[0]=[i("span",{class:"font-semibold text-lg pointer-events-none"},"📊",-1)]),34))}}),ot=e(!0);"undefined"!=typeof document&&(document.documentElement.classList.toggle("dark",ot.value),document.body.classList.toggle("dark",ot.value)),d(ot,e=>{"undefined"!=typeof document&&(document.documentElement.classList.toggle("dark",e),document.body.classList.toggle("dark",e))});const nt=()=>{ot.value=!ot.value},st=u({__name:"ThemeToggleButton",props:{isDarkMode:{type:Boolean,default:!1},sticky:{type:Boolean,default:!0}},setup:e=>(e,t)=>(s(),l("button",{onClick:t[0]||(t[0]=(...e)=>M(nt)&&M(nt)(...e)),class:g(["w-10 h-10 rounded-full shadow-md flex items-center justify-center transition-colors duration-300",[e.sticky?"fixed top-4 right-4 z-50":"",e.isDarkMode?"bg-gray-800 text-white":"bg-white text-gray-800"]])},f(e.isDarkMode?"☀️":"🌙"),3))});const rt={key:0},lt={class:"absolute top-2 left-2 z-10 space-y-2"},it={class:"fixed bottom-[calc(1rem+env(safe-area-inset-bottom,0px))] inset-x-0 flex flex-nowrap overflow-x-auto scrollbar-stable justify-center gap-4 px-4 z-[300]"},ut={key:1,class:"text-center h-screen flex items-center justify-center flex-col"},dt={key:0,class:"text-lg"},ct={key:1,class:"text-red-500"},pt={class:"text-lg"},mt={class:"mt-2"},ft={key:2,class:"text-lg"},gt={__name:"[date]",setup(a){const n=C();r();const u=e(n.params.date),p=e([]),{data:m,metadata:g,loading:h,error:v,load:b}=function(t){const a=e(null),o=e(null),n=e(!1),s=e(null);return{data:a,metadata:o,loading:n,error:s,load:async function(e=M(t)){if(!e)return void(s.value="No date provided");s.value=null,n.value=!0;const r=`staticData-${e}`;try{const e="undefined"!=typeof sessionStorage&&sessionStorage.getItem(r);if(e){const t=JSON.parse(e);return a.value=t.geojson,o.value=t.metadata,void(n.value=!1)}}catch(l){}try{const t=`${X}/data/${e}/enriched.geojson`,n=`${X}/data/${e}/metadata.json`,[s,i]=await Promise.all([fetch(t),fetch(n)]);if(!s.ok)throw new Error(`Failed to fetch GeoJSON: ${s.status}`);if(!i.ok)throw new Error(`Failed to fetch metadata: ${i.status}`);const u=await s.json(),d=await i.json();a.value=u,o.value=d;try{"undefined"!=typeof sessionStorage&&sessionStorage.setItem(r,JSON.stringify({geojson:u,metadata:d}))}catch(l){}}catch(l){s.value=l instanceof Error?l.message:"An unknown error occurred",a.value=null,o.value=null}finally{n.value=!1}}}}(u),k=y(()=>{if(!m.value||!Array.isArray(m.value.features))return 0;const e=m.value.features.length;if(0===e)return 0;return m.value.features.filter(e=>Number(e.properties.mpn)>104).length/e*100}),x=y(()=>k.value>50);return t(async()=>{try{const e=X,t=await fetch(`${e}/data/dates.json`);if(t.ok){const e=await t.json();p.value=Array.isArray(e)?e.sort():[]}}catch(e){}await b()}),d(()=>n.params.date,e=>{e&&(u.value=e,b(e))}),(e,t)=>{var a;return s(),l("div",null,[w(st,{isDarkMode:M(ot)},null,8,["isDarkMode"]),M(m)&&M(g)?(s(),l("div",rt,[M(Ve)?c("",!0):(s(),o(Re,{key:0,dates:p.value,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),isDarkMode:M(ot)},null,8,["dates","modelValue","isDarkMode"])),i("div",lt,[w(Te,{samples:M(m).features,isDarkMode:M(ot)},null,8,["samples","isDarkMode"]),w(Me,{selectedDate:u.value,isDarkMode:M(ot),rainfallData:(null==(a=M(m).features[0])?void 0:a.properties.rainByDay)||[]},null,8,["selectedDate","isDarkMode","rainfallData"])]),w(ge,{selectedDate:u.value,isDarkMode:M(ot),geojson:M(m)},null,8,["selectedDate","isDarkMode","geojson"]),i("div",it,[w(Ge,{isDarkMode:M(ot)},null,8,["isDarkMode"]),w(Je,{isDarkMode:M(ot),showNotification:x.value},null,8,["isDarkMode","showNotification"]),w(tt,{isDarkMode:M(ot)},null,8,["isDarkMode"]),w(at,{isDarkMode:M(ot)},null,8,["isDarkMode"])])])):(s(),l("div",ut,[M(h)?(s(),l("div",dt,"Loading water quality data...")):M(v)?(s(),l("div",ct,[i("p",pt,"Error: "+f(M(v)),1),i("p",mt,"Could not load data for "+f(u.value),1)])):(s(),l("div",ft,"No data available"))]))])}}},yt={name:"RainfallSampleTrend",props:{history:{type:Array,required:!0},isDarkMode:{type:Boolean,default:!1}},setup(a){const o=e(null),n=e(null),s=e(null);let r=null;B.register(T,L,E,I,R,q,V,z,U,F);const l=y(()=>{const e=new Map;for(const t of a.history){const a=new Date(t.date+"T00:00:00Z"),o=t.rainfallByDay||[];for(let n=0;n<o.length;n++){const s=new Date(a);s.setUTCDate(s.getUTCDate()-(o.length-1-n));const r=s.toISOString().slice(0,10);e.has(r)||e.set(r,{date:r,rainfall:o[n]||0,sampleSummary:n===o.length-1?t.sampleSummary:null})}}return Array.from(e.values()).sort((e,t)=>e.date.localeCompare(t.date))}),i=()=>{s.value&&(s.value.scrollLeft=s.value.scrollWidth)},u=y(()=>{const e=a.isDarkMode?"#e5e7eb":"#1f2937",t=a.isDarkMode?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.5)";return{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index"},animation:{duration:400,easing:"easeInOutCubic"},plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label:e=>{const t=l.value[e.dataIndex];if("line"===e.dataset.type)return`Rainfall: ${e.parsed.y} in`;if(!t||!t.sampleSummary)return"";const a=t.sampleSummary.good+t.sampleSummary.caution+t.sampleSummary.unsafe,o=t.sampleSummary[e.dataset.label.toLowerCase()],n=a?Math.round(o/a*100):0;return`${e.dataset.label}: ${o} (${n}%)`},afterBody:e=>{const t=l.value[e[0].dataIndex];if(!t||!t.sampleSummary)return[];return[`Total samples: ${t.sampleSummary.good+t.sampleSummary.caution+t.sampleSummary.unsafe}`]}}}},scales:{ySample:{type:"linear",stacked:!0,position:"left",beginAtZero:!0,max:100,ticks:{color:e},grid:{color:t},title:{display:!0,text:"Sample Quality (%)",color:e,font:{size:10}}},yRain:{type:"linear",position:"right",beginAtZero:!0,ticks:{color:e},grid:{display:!1},title:{display:!0,text:"Rainfall (in)",color:e,font:{size:10}}},x:{ticks:{color:e,maxTicksLimit:12,callback:function(e,t){const a=this.getLabelForValue(e);return 4===new Date(a+"T00:00:00Z").getUTCDay()?a.slice(5):""}},grid:{color:t}}}}});let c=null;const p=(e=100)=>{c&&clearTimeout(c),c=setTimeout(async()=>{await m()},e)},m=async()=>{if(o.value&&0!==a.history.length){r&&(r.destroy(),r=null);try{const e=o.value.getContext("2d"),t=l.value.map(e=>e.date),{rainfall:a,good:n,caution:s,unsafe:i}=(()=>{const e=[],t=[],a=[],o=[];for(const n of l.value)if(e.push(n.rainfall),n.sampleSummary){const e=n.sampleSummary.good+n.sampleSummary.caution+n.sampleSummary.unsafe;t.push(n.sampleSummary.good/e*100),a.push(n.sampleSummary.caution/e*100),o.push(n.sampleSummary.unsafe/e*100)}else t.push(null),a.push(null),o.push(null);return{rainfall:e,good:t,caution:a,unsafe:o}})();r=new B(e,{type:"bar",data:{labels:t,datasets:[{type:"line",label:"Rainfall (in)",data:a,borderColor:"#3b82f6",backgroundColor:"#3b82f6",yAxisID:"yRain",tension:.3},{type:"bar",label:"Good",data:n,backgroundColor:"#16a34a",stack:"samples",yAxisID:"ySample"},{type:"bar",label:"Caution",data:s,backgroundColor:"#eab308",stack:"samples",yAxisID:"ySample"},{type:"bar",label:"Unsafe",data:i,backgroundColor:"#dc2626",stack:"samples",yAxisID:"ySample"}]},options:u.value})}catch(e){}}},f=()=>{r&&r.draw()};return t(async()=>{await P(),await m(),i(),s.value.addEventListener("scroll",f)}),d(()=>a.history,async()=>{p(),i()},{deep:!0}),d(()=>a.isDarkMode,async()=>{p()}),N(()=>{r&&r.destroy(),s.value&&s.value.removeEventListener("scroll",f),c&&clearTimeout(c)}),{chartCanvas:o,axesCanvas:n,scrollContainer:s}}},ht={class:"relative"},vt={ref:"scrollContainer",class:"p-4 relative overflow-x-auto"},bt={class:"min-w-[600px] w-full h-80"},wt={ref:"chartCanvas",class:"w-full h-full"};const kt=ye(yt,[["render",function(e,t,a,o,n,r){return s(),l("div",ht,[i("div",vt,[i("div",bt,[i("canvas",wt,null,512)])],512)])}],["__scopeId","data-v-a141f70d"]]),xt={class:"min-h-screen bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200"},Dt={class:"max-w-screen-lg mx-auto px-4 pt-14 pb-24 text-center"},Mt={key:0,class:"text-center py-10"},Ct={key:1,class:"overflow-x-auto"},Pt={__name:"trends",setup(a){const o=e([]),r=e(!0);return t(async()=>{try{const e=X,t=await fetch(`${e}/data/dates.json`),a=await t.json()||[],n=(await Promise.all(a.map(async t=>{var a;const o=await fetch(`${e}/data/${t}/enriched.geojson`);if(!o.ok)return null;const n=await o.json(),s={good:0,caution:0,unsafe:0};for(const e of n.features){const t=Number(e.properties.mpn);t<35?s.good++:t<=104?s.caution++:s.unsafe++}return{date:t,rainfallByDay:(null==(a=n.features[0])?void 0:a.properties.rainByDay)||[],sampleSummary:s}}))).filter(Boolean);o.value=n.sort((e,t)=>e.date.localeCompare(t.date))}catch(e){}finally{r.value=!1}}),(e,t)=>{const a=n("router-link");return s(),l("div",xt,[i("div",Dt,[w(st,{isDarkMode:M(ot)},null,8,["isDarkMode"]),t[1]||(t[1]=i("h1",{class:"text-2xl font-bold mb-6 text-gray-900 dark:text-white"}," Trends: Rainfall vs Water Quality ",-1)),r.value?(s(),l("div",Mt,"Loading…")):(s(),l("div",Ct,[w(kt,{history:o.value,isDarkMode:M(ot)},null,8,["history","isDarkMode"])])),t[2]||(t[2]=S('<div class="flex flex-row flex-wrap justify-center gap-4 mt-4 text-xs"><div class="flex items-center gap-1"><span class="w-3 h-3 bg-blue-500 rounded"></span> Rainfall (in)</div><div class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded"></span> Good (&lt;35)</div><div class="flex items-center gap-1"><span class="w-3 h-3 bg-yellow-400 rounded"></span> Caution (35–104)</div><div class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded"></span> Unsafe (&gt;104)</div></div><p class="text-base text-gray-700 dark:text-gray-300 mt-6 max-w-prose mx-auto"> Each dot in the line shows daily rainfall totals for the past several weeks. Water quality samples are collected on Thursdays, and each stacked bar shows how many samples fell into good, caution, or unsafe zones that day. Since NYC’s sewers overflow during storms, rainfall right before Thursday is the biggest factor in poor water quality. </p>',2)),w(a,{to:"/",class:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50"},{default:k(()=>t[0]||(t[0]=[i("button",{class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-black dark:text-white rounded-full shadow-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"}," ← Back to Map ",-1)])),_:1,__:[0]})])])}}},Nt=_({history:$(`${X}/`),routes:[{path:"/",redirect:`/${ee}`},{path:"/index",component:ae},{path:"/:date",component:gt},{path:"/trends",component:Pt}]});!async function(){try{const e="phc_w0axXDyN3zCal0qUUsV83NnyCoKsI9AKHXR59aat3tP";if(K)return;const t=await function(e,t){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),n=(null==o?void 0:o.nonce)||(null==o?void 0:o.getAttribute("nonce"));a=e(t.map(e=>{if((e=function(e){return"/nyc-water-app/"+e}(e))in Z)return;Z[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,n&&o.setAttribute("nonce",n),document.head.appendChild(o),t?new Promise((t,a)=>{o.addEventListener("load",t),o.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})}(()=>import("./analytics-BlUJbZ5Q.js"),[]);G=t.default||t;const a="https://app.posthog.com";G.init(e,{api_host:a,autocapture:!0,debug:!1}),K=!0}catch(e){}}(),Nt.afterEach(()=>{J("$pageview")});const St=O(H);St.use(Nt),St.mount("#app");
